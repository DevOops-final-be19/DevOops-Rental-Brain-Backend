<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.devoops.rentalbrain.employee.query.mapper.EmployeeQueryMapper">
    <resultMap id="empInfoPageResultMap" type="com.devoops.rentalbrain.employee.query.dto.EmployeeInfoDTO">
        <id property="id" column="id"/>
        <result property="emp_id" column="emp_id"/>
        <result property="phone" column="phone"/>
        <result property="email" column="email"/>
        <result property="addr" column="addr"/>
        <result property="birthday" column="birthday"/>
        <result property="gender" column="gender"/>
        <result property="status" column="status"/>
        <result property="dept" column="dept"/>
        <result property="hire_date" column="hire_date"/>
        <association property="position" javaType="com.devoops.rentalbrain.employee.query.dto.PositionDTO">
            <id property="position_id" column="position_id"/>
            <result property="position_name" column="position_name"/>
        </association>

    </resultMap>
    <select id="getUserAuth" resultType="string">
        SELECT
               a.auth
          FROM auth_list a
         WHERE a.id IN (SELECT
                               b.auth_id
                          FROM employee_auth b
                         WHERE emp_id = #{empId}
                         UNION
                        SELECT
                               c.auth_id
                          FROM emp_position_auth c
                         WHERE position_id = #{positionId})
    </select>
    <select id="getEmpInfoPage" resultMap="empInfoPageResultMap">
        SELECT
               a.id,
               a.emp_id,
               a.phone,
               a.email,
               a.addr,
               a.birthday,
               a.gender,
               a.status,
               a.dept,
               a.hire_date,
               b.id as position_id,
               b.position_name
          FROM employee a JOIN emp_position b
            ON a.position_id = b.id
         WHERE emp_id = #{empId}
    </select>


</mapper>